<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<!-- Basic -->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Mobile Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Site Metas -->
    <title>Shop-detail</title>

</head>

<body>
<div th:include="fragment/header :: body"></div>

<!-- Start All Title Box -->
<div class="all-title-box">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <h2>Shop Detail</h2>
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">Shop</a></li>
                    <li class="breadcrumb-item active">Shop Detail </li>
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- End All Title Box -->

<!-- Start Shop Detail  -->
<div class="shop-detail-box-main">
    <div class="container">
        <form th:object="${cartForm}" th:action="@{/cart/addToCart}" method="post">
            <input type="hidden" th:value="${productId}" id="productId" name="productId">
            <div class="row">
                <div class="col-xl-5 col-lg-5 col-md-6">
                    <div id="carousel-example-1" class="single-product-slider carousel slide" data-ride="carousel">
                        <div class="carousel-inner" role="listbox">
                            <div class="carousel-item active"> <img class="d-block w-100" th:src="@{|/${product.picture.mainPicture}|}" alt="First slide"> </div>
                            <!--                            <div class="carousel-item"> <img class="d-block w-100" src="images/big-img-02.jpg" alt="Second slide"> </div>-->
                            <!--                            <div class="carousel-item"> <img class="d-block w-100" src="images/big-img-03.jpg" alt="Third slide"> </div>-->
                        </div>
                        <a class="carousel-control-prev" href="#carousel-example-1" role="button" data-slide="prev">
                            <i class="fa fa-angle-left" aria-hidden="true"></i>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="carousel-control-next" href="#carousel-example-1" role="button" data-slide="next">
                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                            <span class="sr-only">Next</span>
                        </a>
                        <ol class="carousel-indicators">
                            <li data-target="#carousel-example-1" data-slide-to="0" class="active">
                                <img class="d-block w-100 img-fluid" th:src="@{|/${product.picture.mainPicture}|}" alt="first" />
                            </li>
                            <li data-target="#carousel-example-1" data-slide-to="1">
                                <img class="d-block w-100 img-fluid" th:src="@{|/${product.picture.picture1}|}" alt="second" />
                            </li>
                            <li data-target="#carousel-example-1" data-slide-to="2">
                                <img class="d-block w-100 img-fluid" th:src="@{|/${product.picture.picture2}|}" alt="third" />
                            </li>
                        </ol>
                    </div>
                </div>
                <div class="col-xl-7 col-lg-7 col-md-6">
                    <div class="single-product-details">
                        <h2 th:text="${product.name}"></h2>
                        <h5 th:text="${product.price}"></h5>
                        <th:block th:each="warehouse: ${warehouse}">
                            <span th:text="|More than ${warehouse.stock} available in warehouse ${warehouse.name}|"></span>
                        </th:block>
                        <h4>Short Description:</h4>
                        <p th:text="${product.description}"></p>
                        <ul>
                            <li>
                                <div class="form-group size-st">
                                    <label class="size-label">Size</label>
                                    <select id="basic1" class="show-tick form-control"
                                            name="size" th:field="*{size}">
                                        <option value="0">Size</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                        <option value="9">9</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                    </select>
                                </div>
                            </li>
                            <li>
                                <div class="form-group quantity-box">
                                    <label class="control-label">Quantity</label>
                                    <input class="form-control" th:value="1" min="1" max="99" type="number"
                                           name="quantity" th:field="*{quantity}">
                                </div>
                            </li>
                        </ul>
                        <div class="price-box-bar">
                            <div class="cart-and-bay-btn">
                                <button class="btn hvr-hover" data-fancybox-close=""
                                        style="color: white" onclick="location.href='/cart'">Move to cart</button>
                                <!--                                        <a class="btn hvr-hover" data-fancybox-close="" th:href="@{#}">Add to cart</a>-->
                                <button type="submit" class="btn hvr-hover" style="color: white">Add to card</button>
                            </div>
                        </div>
                        <div class="add-to-btn">
                            <div class="add-comp">
                                <a class="btn hvr-hover" href="#"><i class="fas fa-heart"></i> Add to wishlist</a>
                            </div>
                            <div class="share-bar">
                                <a class="btn hvr-hover" href="#"><i class="fab fa-facebook" aria-hidden="true"></i></a>
                                <a class="btn hvr-hover" href="#"><i class="fab fa-google-plus" aria-hidden="true"></i></a>
                                <a class="btn hvr-hover" href="#"><i class="fab fa-twitter" aria-hidden="true"></i></a>
                                <a class="btn hvr-hover" href="#"><i class="fab fa-pinterest-p" aria-hidden="true"></i></a>
                                <a class="btn hvr-hover" href="#"><i class="fab fa-whatsapp" aria-hidden="true"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <div class="row my-5">
            <div class="col-lg-12">
                <div class="title-all text-center">
                    <h1>Featured Products</h1>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed sit amet lacus enim.</p>
                </div>
                <div class="featured-products-box owl-carousel owl-theme">
                    <div class="item">
                        <div class="products-single fix">
                            <div class="box-img-hover">
                                <img src="/images/img-pro-01.jpg" class="img-fluid" alt="Image">
                                <div class="mask-icon">
                                    <ul>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="View"><i class="fas fa-eye"></i></a></li>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="Compare"><i class="fas fa-sync-alt"></i></a></li>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="Add to Wishlist"><i class="far fa-heart"></i></a></li>
                                    </ul>
                                    <a class="cart" href="#">Add to Cart</a>
                                </div>
                            </div>
                            <div class="why-text">
                                <h4>Lorem ipsum dolor sit amet</h4>
                                <h5> $9.79</h5>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="products-single fix">
                            <div class="box-img-hover">
                                <img src="/images/img-pro-02.jpg" class="img-fluid" alt="Image">
                                <div class="mask-icon">
                                    <ul>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="View"><i class="fas fa-eye"></i></a></li>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="Compare"><i class="fas fa-sync-alt"></i></a></li>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="Add to Wishlist"><i class="far fa-heart"></i></a></li>
                                    </ul>
                                    <a class="cart" href="#">Add to Cart</a>
                                </div>
                            </div>
                            <div class="why-text">
                                <h4>Lorem ipsum dolor sit amet</h4>
                                <h5> $9.79</h5>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="products-single fix">
                            <div class="box-img-hover">
                                <img src="/images/img-pro-03.jpg" class="img-fluid" alt="Image">
                                <div class="mask-icon">
                                    <ul>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="View"><i class="fas fa-eye"></i></a></li>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="Compare"><i class="fas fa-sync-alt"></i></a></li>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="Add to Wishlist"><i class="far fa-heart"></i></a></li>
                                    </ul>
                                    <a class="cart" href="#">Add to Cart</a>
                                </div>
                            </div>
                            <div class="why-text">
                                <h4>Lorem ipsum dolor sit amet</h4>
                                <h5> $9.79</h5>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="products-single fix">
                            <div class="box-img-hover">
                                <img src="/images/img-pro-04.jpg" class="img-fluid" alt="Image">
                                <div class="mask-icon">
                                    <ul>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="View"><i class="fas fa-eye"></i></a></li>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="Compare"><i class="fas fa-sync-alt"></i></a></li>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="Add to Wishlist"><i class="far fa-heart"></i></a></li>
                                    </ul>
                                    <a class="cart" href="#">Add to Cart</a>
                                </div>
                            </div>
                            <div class="why-text">
                                <h4>Lorem ipsum dolor sit amet</h4>
                                <h5> $9.79</h5>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="products-single fix">
                            <div class="box-img-hover">
                                <img src="/images/img-pro-01.jpg" class="img-fluid" alt="Image">
                                <div class="mask-icon">
                                    <ul>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="View"><i class="fas fa-eye"></i></a></li>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="Compare"><i class="fas fa-sync-alt"></i></a></li>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="Add to Wishlist"><i class="far fa-heart"></i></a></li>
                                    </ul>
                                    <a class="cart" href="#">Add to Cart</a>
                                </div>
                            </div>
                            <div class="why-text">
                                <h4>Lorem ipsum dolor sit amet</h4>
                                <h5> $9.79</h5>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="products-single fix">
                            <div class="box-img-hover">
                                <img src="/images/img-pro-02.jpg" class="img-fluid" alt="Image">
                                <div class="mask-icon">
                                    <ul>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="View"><i class="fas fa-eye"></i></a></li>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="Compare"><i class="fas fa-sync-alt"></i></a></li>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="Add to Wishlist"><i class="far fa-heart"></i></a></li>
                                    </ul>
                                    <a class="cart" href="#">Add to Cart</a>
                                </div>
                            </div>
                            <div class="why-text">
                                <h4>Lorem ipsum dolor sit amet</h4>
                                <h5> $9.79</h5>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="products-single fix">
                            <div class="box-img-hover">
                                <img src="/images/img-pro-03.jpg" class="img-fluid" alt="Image">
                                <div class="mask-icon">
                                    <ul>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="View"><i class="fas fa-eye"></i></a></li>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="Compare"><i class="fas fa-sync-alt"></i></a></li>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="Add to Wishlist"><i class="far fa-heart"></i></a></li>
                                    </ul>
                                    <a class="cart" href="#">Add to Cart</a>
                                </div>
                            </div>
                            <div class="why-text">
                                <h4>Lorem ipsum dolor sit amet</h4>
                                <h5> $9.79</h5>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="products-single fix">
                            <div class="box-img-hover">
                                <img src="/images/img-pro-04.jpg" class="img-fluid" alt="Image">
                                <div class="mask-icon">
                                    <ul>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="View"><i class="fas fa-eye"></i></a></li>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="Compare"><i class="fas fa-sync-alt"></i></a></li>
                                        <li><a href="#" data-toggle="tooltip" data-placement="right" title="Add to Wishlist"><i class="far fa-heart"></i></a></li>
                                    </ul>
                                    <a class="cart" href="#">Add to Cart</a>
                                </div>
                            </div>
                            <div class="why-text">
                                <h4>Lorem ipsum dolor sit amet</h4>
                                <h5> $9.79</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
<!-- End Cart -->

<section class="content-item" id="comments">
    <div class="container">
        <div class="row">
            <div class="col-sm-8">
                <div sec:authorize="isAuthenticated()">
                    <input type="submit" class="btn btn-normal pull-right" value="Add comment" onclick="saveComment();">
                </div>
                <form sec:authorize="isAuthenticated()">
                    <h3 class="pull-left">New Comment</h3>
                    <fieldset>
                        <div class="row">
                            <div class="col-sm-3 col-lg-2 hidden-xs">
                                <img width="100px;"
                                     class="img-responsive" src="https://bootdey.com/img/Content/avatar/avatar3.png" alt="">
                            </div>
                            <div class="form-group col-xs-12 col-sm-9 col-lg-10">
                                <textarea class="form-control" id="message" name="message"
                                          placeholder="Your message" required="" value=""></textarea>
                            </div>
                        </div>
                    </fieldset>
                </form>

                <h3>Comments</h3>

                <div id="allComments" th:each="comment: ${comments}">
                <div th:id="|comment${comment.id}|" class="media">
                    <a class="pull-left" href="#">
                        <img class="media-object" th:src="|https://bootdey.com/img/Content/avatar/avatar${comment.user.id}.png|" alt="">
                    </a>
                    <div class="media-body">
                        <h4 class="media-heading"
                                  th:utext="|${comment.user.firstName} ${comment.user.lastName}|"></h4>
                        <p th:id="|textComment${comment.id}|" th:utext="${comment.comment}"></p>
                        <div th:id="|editComment${comment.id}|" class="form-group col-xs-12 col-sm-9 col-lg-10" style="display: none;">
                            <input type="text" th:id="|inputEditComment${comment.id}|" class="form-control" value="">
                            <input type="button" class="btn btn-cyan btn-sm" value="Submit"
                                   th:onclick="|editComment(${comment.id});|">
                        </div>
                        <ul class="list-unstyled list-inline media-detail pull-left">
                            <li>
                                <i class="fa fa-calendar"></i>
                                <span th:id="|dateComment${comment.id}|"
                                        th:utext="|${#dates.format(comment.updatedOn, 'dd-MM-yyyy HH:mm')}|"></span>
                            </li>
<!--                            <li><i class="fa fa-thumbs-up"></i></li>-->
                        </ul>
                        <ul th:if="${#authentication.getName() == comment.user.email}"
                            class="list-unstyled list-inline media-detail pull-right">
                            <li class="">
                                <input type="button" class="btn btn-link btn-sm"
                                       th:onclick="|showEditComment(${comment.id});|" value="Edit">
                            </li>
                            <li class="">
                                <input type="button" class="btn btn-link btn-sm"
                                       th:onclick="|deleteComment(${comment.id});|" value="Delete">
                            </li>
                        </ul>
                    </div>
                </div>
                </div>

            </div>
        </div>
    </div>
</section>

<div th:include="fragment/footer :: body"></div>

</body>

<script th:inline="javascript" type="text/javascript">
    function saveComment() {
        let message = $("#message").val();
        let productId = $("#productId").val();

        let json = {
            "comment": message,
            "productId": productId,
        };

        if (message != "") {
            $.ajax({
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                type : "POST",
                url : "/ajax/createComment",
                data : JSON.stringify(json),
                dataType: "json",
                success : function(response) {
                    let updatedOn = new Date(response.updatedOn);
                    let dateFormat = moment(updatedOn).format('DD.MM.YY HH:mm');

                    let newMessage = "";
                    newMessage += "<div class=\"media\">"
                        + "<a class=\"pull-left\" href=\"#\">"
                        + "<img class=\"media-object\" src=\"https://bootdey.com/img/Content/avatar/avatar3.png\" alt=\"\">"
                        + "</a>";
                    newMessage += "<div class=\"media-body\">";
                    newMessage += "<h4 className=\"media-heading\">"
                        + response.user.firstName + " " + response.user.lastName
                        + "</h4>";
                    newMessage += "<p>"
                        + response.comment
                        + "</p>";
                    newMessage += "<ul className=\"list-unstyled list-inline media-detail pull-left\">"
                        + "<li><i className=\"fa fa-calendar\"></i>"
                        + dateFormat
                        + "</li></ul>";
                    newMessage += "</div>";
                    newMessage += "</div>";

                    $("#allComments").prepend(newMessage);
                    $("#message").val('')
                },
                error: function(error) {
                    console.log("Error: " + error);
                },
            });
        }
    }

    function showEditComment(id) {
        let comment = document.getElementById("editComment" + id);
        if (comment.style.display === "none") {
            document.getElementById("editComment" + id).style.display = "block";
        } else {
            document.getElementById("editComment" + id).style.display = "none";
        }
    }

    function editComment(id) {
        let comment = $("#inputEditComment" + id).val();

        let json = {
            "commentId": id,
            "comment": comment
        };

        if (comment != "") {
            $.ajax({
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                type : "POST",
                url : "/ajax/editComment",
                data : JSON.stringify(json),
                dataType: "json",
                success : function(response) {
                    $("#inputEditComment" + id).val('');
                    document.getElementById("editComment" + id).style.display = "none";

                    let updatedOn = new Date(response.updatedOn);
                    let dateFormat = moment(updatedOn).format('DD.MM.YY HH:mm');
                    $("#dateComment" + id).text(dateFormat);
                    document.getElementById("textComment" + id).innerText = response.comment;
                },
                error: function(error) {
                    console.log("Error: " + error);
                },
            });
        }
    }

    function deleteComment(id) {
        if (confirm("Are you sure to delete this comment?")) {
            $.ajax({
                url: "/ajax/deleteComment",
                data: {
                    commentId: id
                },
                dataType: "json",
                success: function (response) {
                    if (response) {
                        document.getElementById("comment" + id).remove();
                        alert("Deleted comment");
                    } else {
                        alert("Error delete comment")
                    }
                },
                error: function (error) {
                    console.log("Error: " + error);
                },
            });
        }
    }
</script>

</html>
